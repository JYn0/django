# 배포

1206



`heroku.com`  가입

`herocu cli` 설치

AWS

EC2(는 막혀서 못함)



---------------------



`day19` 배포하기



```shell
$ python -m venv venv # venv 없을때

settings.py
Generated by 'django-admin startproject' using Django 2.2.7.
pip list -> Django 버전이 같아야함

$ pip uninstall django
$ pip install django==2.2.7
```



`python manage.py runserver` 서버를 실행했을때 에러가 있으면 안됨



`settings.py`

```python
# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'sx5we^$%&5v5xbi6*5=@y%wrxfqfkmk6a9e33ei^rl#5j65#_#'
#보안에서는 가려져야함

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = False # 배포할땐 False

ALLOWED_HOSTS = ['127.0.0.1', '']
```

```shell
$ git init
$ git add .
$ git commit -m 'ready to deploy'
$ pip install django_heroku
```

`settings.py`

```python
# 마지막줄
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
# collect static 자동으로 실행, 모든 static파일을 
# BASE_DIR 안에 static 폴더가 생김

# 마지막줄
import django_heroku
django_heroku.settings(locals())
```

```shell
/ (root에서)
$ touch Procfile
```

`Procfile`

```Procfile
web: gunicorn 프로젝트이름.wsgi --log-file -
# heroku가 가장 첫번째 보는 곳
# wsgi -> gate
```

```shell
$ pip install gunicorn
/ (root에서)
$ touch runtime.txt
$ python -V
Python 3.7.4
$ pip freeze > requirements
```

`runtime.txt`

```txt
python-3.7.4
(3.7.5)
```

```shell
$ heroku
$ heroku login (q는 exit, 아무거나 press)
Chrome으로 로그인하고 끄기
$ heroku create 서비스이름(안쓰면 랜덤값)
$ git remote -v
(X) $ heroku config:set DEBUG=False

$ git add .
$ git commit -m ''

$ git push heroku master

$ heroku run python manage.py migrate
# run이 붙으면 여기서 하는것이 아니라 그 컴퓨터에서 실행
```

`https://dashboard.heroku.com/` 

more - runconsole - `python manage.py migrate` - run

```shell
$ python manage.py dumpdata
-> local에 있는 데이터를 json으로 출력
마스터앱 아닌 곳에 fixtures폴더 만들기
$ python manage.py dumpdata > codi/fixtures/data.json

$ git add .
$ git commit -m 'add dump data'
$ git push heroku master
$ python manage.py loaddata data
more-runconsole에서도 실행
# 알아서 data.json을 찾아감
```



